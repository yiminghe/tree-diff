{"version":3,"sources":["webpack:///./src/diff.js?4612","webpack:///./src/patch.js?2cda","webpack:///./examples/renderDOM.js","webpack:///./src/dom/renderDOM.js","webpack:///./src/dom/createDOMNode.js","webpack:///./src/dom/patchDOM.js"],"names":["diffTree","indexOf","nodes","node","isSame","nodeIndex","len","length","i","nativeShould","a","b","sortByIndex","currentIndex","diff","currentNodes","nextNodes","options","internal","shouldUpdate","childrenKey","path","parentNode","insertQueue","updateQueue","removeQueue","lastIndex","tmp","forEach","nextNode","nextIndex","currentNode","push","type","concat","toPath","Math","max","sort","o","currentChildren","nextChildren","ret","patch","processNew","processUpdate","processMove","processRemove","q","moves","join","simplifyOperations","operations","JSON","parse","stringify","k","v","undefined","dom","props","children","key","vdom1","container","document","createElement","getElementById","appendChild","update","onclick","console","log","getDefaultKeyFromIndex","index","prevElement","nextElement","prevElementIndex","nextElementIndex","prevEmpty","nextEmpty","prevType","nextType","renderDOM","vdom_","root","vdom","Array","isArray","n","c","currentVDom","nextVDom_","nextVDom","queue","createDOMNode","doc","createTextNode","name","hasOwnProperty","setAttribute","child","findNodeByPath","parent","reduce","p","childNodes","newNode","insertBefore","_","removeChild","nodeValue","currentProps","nextProps","nextName","nextValue","currentValue","currentName","removeAttribute","patchDOM","bind"],"mappings":"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","file":"renderDOM.js","sourcesContent":["function indexOf(nodes, node, isSame, nodeIndex) {\n  const len = nodes.length;\n  for (let i = 0; i < len; i++) {\n    if (isSame(node, nodes[i], nodeIndex, i)) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nfunction nativeShould(a, b) {\n  return a === b;\n}\n\nfunction sortByIndex(a, b) {\n  if (a.currentIndex === b.currentIndex) {\n    return 0;\n  }\n  return a.currentIndex > b.currentIndex ? -1 : 1;\n}\n\n// diff by level\nfunction diff(currentNodes, nextNodes, options = {}, internal = {}) {\n  const { shouldUpdate = nativeShould, childrenKey = 'children' } = options;\n  const { path = [], parentNode } = internal;\n  let insertQueue = [];\n  let updateQueue = [];\n  let removeQueue = [];\n  let lastIndex = 0;\n  let tmp;\n  nextNodes.forEach((nextNode, nextIndex) => {\n    const currentIndex = indexOf(currentNodes, nextNode, shouldUpdate, nextIndex);\n    if (currentIndex !== -1) {\n      const currentNode = currentNodes[currentIndex];\n      updateQueue.push({\n        type: 'update',\n        currentNode,\n        nextNode,\n        parentNode,\n        path: path.concat(currentIndex),\n      });\n      if (currentIndex < lastIndex) {\n        tmp = {\n          type: 'move',\n          currentNode,\n          nextNode,\n          parentNode,\n          currentIndex,\n          path: path.concat(currentIndex),\n          toPath: path.concat(nextIndex),\n        };\n        insertQueue.push(tmp);\n        removeQueue.push(tmp);\n      }\n      lastIndex = Math.max(currentIndex, lastIndex);\n    } else {\n      insertQueue.push({\n        type: 'new',\n        nextNode,\n        parentNode,\n        toPath: path.concat(nextIndex),\n      });\n    }\n  });\n\n  currentNodes.forEach((currentNode, currentIndex) => {\n    const nextIndex = indexOf(nextNodes, currentNode, shouldUpdate, currentIndex);\n    if (nextIndex === -1) {\n      removeQueue.push({\n        type: 'remove',\n        currentNode,\n        parentNode,\n        currentIndex,\n        path: path.concat(currentIndex),\n      });\n    }\n  });\n\n  removeQueue.sort(sortByIndex);\n\n  if (childrenKey) {\n    updateQueue.concat().forEach((o) => {\n      const currentChildren = o.currentNode[childrenKey] || [];\n      const nextChildren = o.nextNode[childrenKey] || [];\n      // bottom up\n      const ret = diff(currentChildren, nextChildren, options, {\n        path: o.path,\n        parentNode: o.currentNode,\n      });\n      insertQueue = ret.insertQueue.concat(insertQueue);\n      updateQueue = ret.updateQueue.concat(updateQueue);\n      removeQueue = ret.removeQueue.concat(removeQueue);\n    });\n  }\n\n  return {\n    insertQueue,\n    updateQueue,\n    removeQueue,\n  };\n}\n\nexport default function diffTree(currentNodes, nextNodes, options) {\n  return diff(currentNodes, nextNodes, options);\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/diff.js\n **/","function patch({ removeQueue, insertQueue, updateQueue }, {\n  processNew,\n  processUpdate,\n  processMove,\n  processRemove,\n}) {\n  updateQueue.forEach((q) => {\n    processUpdate(q);\n  });\n\n  const moves = {};\n\n  removeQueue.forEach((q) => {\n    const ret = processRemove(q);\n    if (q.type === 'move') {\n      moves[q.toPath.join(',')] = ret;\n    }\n  });\n\n  insertQueue.forEach((q) => {\n    if (q.type === 'new') {\n      processNew(q);\n    } else if (q.type === 'move') {\n      processMove(q, moves[q.toPath.join(',')]);\n    }\n  });\n}\n\nexport default patch;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/patch.js\n **/","/** @jsx dom */\n\n/* eslint no-console:0 */\n\nimport renderDOM from 'tree-diff/src/dom/renderDOM';\n\nfunction simplifyOperations(operations) {\n  return JSON.parse(JSON.stringify(operations, (k, v) => {\n    return k === 'children' || k === 'props' ? undefined : v;\n  }));\n}\n\nfunction dom(type, props, ...children) {\n  const ret = {\n    type,\n    props,\n    children,\n  };\n  if (props && props.key) {\n    ret.key = props.key;\n    delete props.key;\n  }\n  return ret;\n}\n\n(() => {\n  const vdom1 = (<div>\n    <h2>no key</h2>\n    <p id=\"1\">1</p>\n    <p id=\"2\">2</p>\n    <button id=\"t\">change</button>\n  </div>);\n  const container = document.createElement('div');\n  document.getElementById('__react-content').appendChild(container);\n\n  const { update } = renderDOM(vdom1, container);\n\n  document.getElementById('t').onclick = () => {\n    const operations = update(<div>\n      <h2>no key</h2>\n      <p id=\"2\">2</p>\n      <p id=\"1\">1</p>\n      <p id=\"3\">3</p>\n      <button id=\"t\">change</button>\n    </div>);\n    console.log('operations', (simplifyOperations(operations)));\n  };\n})();\n\n(() => {\n  const vdom1 = (<div>\n    <h2>with key</h2>\n    <p key=\"1\">1</p>\n    <p key=\"2\">2</p>\n    <button key=\"t\" id=\"t2\">change</button>\n  </div>);\n  const container = document.createElement('div');\n  document.getElementById('__react-content').appendChild(container);\n\n  const { update } = renderDOM(vdom1, container);\n\n  document.getElementById('t2').onclick = () => {\n    const operations = update(<div>\n      <h2>with key</h2>\n      <p key=\"2\">2</p>\n      <p key=\"1\">1</p>\n      <p key=\"3\">3</p>\n      <button key=\"t\" id=\"t\">change</button>\n    </div>);\n\n    console.log('operations', (simplifyOperations(operations)));\n  };\n})();\n\n\n\n/** WEBPACK FOOTER **\n ** ./examples/renderDOM.js\n **/","import diff from '../diff';\nimport createDOMNode from './createDOMNode';\nimport patchDOM from './patchDOM';\n\nfunction getDefaultKeyFromIndex(index) {\n  return `.${index}`;\n}\n\nfunction shouldUpdate(prevElement, nextElement, prevElementIndex, nextElementIndex) {\n  const prevEmpty = prevElement === null || prevElement === false;\n  const nextEmpty = nextElement === null || nextElement === false;\n  if (prevEmpty || nextEmpty) {\n    return prevEmpty === nextEmpty;\n  }\n\n  const prevType = typeof prevElement;\n  const nextType = typeof nextElement;\n  if (prevType === 'string' || prevType === 'number') {\n    return (nextType === 'string' || nextType === 'number');\n  }\n  return (\n    nextType === 'object' &&\n    prevElement.type === nextElement.type &&\n    (prevElement.key || getDefaultKeyFromIndex(prevElementIndex))\n    === (nextElement.key || getDefaultKeyFromIndex(nextElementIndex))\n  );\n}\n\nfunction renderDOM(vdom_, root) {\n  let vdom = vdom_;\n  if (!Array.isArray(vdom_)) {\n    vdom = [vdom_];\n  }\n  vdom.forEach((n) => {\n    const c = createDOMNode(n);\n    root.appendChild(c);\n  });\n  let currentVDom = vdom;\n  return {\n    update(nextVDom_) {\n      let nextVDom = nextVDom_;\n      if (!Array.isArray(nextVDom)) {\n        nextVDom = [nextVDom];\n      }\n      const queue = diff(currentVDom, nextVDom, { shouldUpdate });\n      currentVDom = nextVDom;\n      patchDOM(queue, root);\n      return queue;\n    },\n  };\n}\n\nexport default renderDOM;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/dom/renderDOM.js\n **/","function createDOMNode(vdom, doc = document) {\n  if (typeof vdom === 'string') {\n    return doc.createTextNode(vdom);\n  }\n  const { type, props } = vdom;\n  const node = doc.createElement(type);\n  for (const name in props) {\n    if (props.hasOwnProperty(name)) {\n      node.setAttribute(name, props[name]);\n    }\n  }\n  if (vdom.children) {\n    vdom.children.forEach((c) => {\n      const child = createDOMNode(c, doc);\n      node.appendChild(child);\n    });\n  }\n  return node;\n}\n\nexport default createDOMNode;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/dom/createDOMNode.js\n **/","import patch from '../patch';\nimport createDOMNode from './createDOMNode';\n\nfunction findNodeByPath(root, path) {\n  let parent = root;\n  const node = path.reduce(\n      (n, p) => {\n        parent = n;\n        return n.childNodes[p];\n      },\n      root) || null;\n  return {\n    node,\n    parent,\n  };\n}\n\nfunction processNew(root, q) {\n  const { nextNode, toPath } = q;\n  const newNode = createDOMNode(nextNode);\n  const { parent, node } = findNodeByPath(root, toPath);\n  parent.insertBefore(newNode, node);\n}\n\nfunction processMove(_, q, { parent, node }) {\n  const { toPath } = q;\n  parent.insertBefore(node, parent.childNodes[toPath[toPath.length - 1]] || null);\n}\n\nfunction processRemove(root, q) {\n  const { path } = q;\n  const { parent, node } = findNodeByPath(root, path);\n  parent.removeChild(node);\n  return { parent, node };\n}\n\nfunction processUpdate(root, q) {\n  const { path, currentNode, nextNode } = q;\n  const { node } = findNodeByPath(root, path);\n  if (typeof nextNode === 'string') {\n    if (nextNode !== currentNode) {\n      node.nodeValue = nextNode;\n    }\n    return;\n  }\n  const currentProps = currentNode.props;\n  const nextProps = nextNode.props;\n  for (const nextName in nextProps) {\n    if (nextProps.hasOwnProperty(nextName)) {\n      const nextValue = nextProps[nextName];\n      const currentValue = currentProps[nextName];\n      if (nextValue !== currentValue) {\n        node.setAttribute(nextName, nextValue);\n      }\n    }\n  }\n  for (const currentName in currentProps) {\n    if (currentProps.hasOwnProperty(currentName) && !nextProps.hasOwnProperty(currentName)) {\n      node.removeAttribute(currentName);\n    }\n  }\n}\n\nfunction patchDOM(queue, root) {\n  patch(queue, {\n    processNew: processNew.bind(null, root),\n    processMove: processMove.bind(null, root),\n    processUpdate: processUpdate.bind(null, root),\n    processRemove: processRemove.bind(null, root),\n  });\n}\n\nexport default patchDOM;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/dom/patchDOM.js\n **/"],"sourceRoot":""}